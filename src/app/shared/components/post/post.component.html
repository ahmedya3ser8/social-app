<section class="bg-white px-5 py-8 rounded-lg shadow max-w-xl mx-auto">
  <div class="post flex flex-col gap-4">
    <div class="post_head flex justify-between items-center">
      <div class="flex gap-4">
        <div class="image">
          <img src="/images/profile.png" class="size-10" alt="profile" />
        </div>
        <div class="content">
          <h3 class="text-gray-700 font-medium"> {{post().user.name}} </h3>
          <p class="text-gray-400 text-sm"> {{post().createdAt | date}} </p>
        </div>
      </div>
      <button (click)="menu.toggle($event)" class="cursor-pointer">
        <i class="fa-solid fa-ellipsis"></i>
        <p-menu #menu [model]="items" [popup]="true" appendTo="body"></p-menu>
      </button>
    </div>
    @if (post().body) {
      <p class="post_description text-gray-700 font-medium"> {{post().body}} </p>
    }
    @if (post().image) {
      <div [routerLink]="['/posts', post()._id]" class="post_image cursor-pointer">
        <img [src]="post().image" class="w-full h-[400px] object-cover rounded-md" alt="post-image" />
      </div>
    }
    <button #showCommentBtn class="text-cyan-700 font-medium text-left cursor-pointer"> show comments </button>
  </div>
  @defer (on interaction(showCommentBtn)) {
    <div class="flex flex-col gap-4 mt-6">
      @for (comment of postComments().slice(0, 10).reverse(); track comment._id) {
        <app-comment [comment]="comment" />
      }
    </div>
    <div class="bg-[#f6f6f6] p-5 rounded-lg shadow flex gap-2 mt-4">
      <textarea
        [formControl]="commentMessage"
        class="w-full bg-white p-2 outline-none rounded-md border border-gray-400 h-12 resize-none"
        [class.border-red-600]="commentMessage.errors && commentMessage.touched"
        placeholder="Your comment..."
      ></textarea>
      <button (click)="submitForm()" class="cursor-pointer">
        <i class="fa-solid fa-play text-cyan-600 font-bold text-2xl"></i>
      </button>
    </div>
  }
</section>


@if (openModal()) {
  <div class="modal fixed inset-0 bg-black/20 flex justify-center items-center z-[9999]">
    <div class="modal_container bg-white w-md p-4 rounded-md flex flex-col gap-4">
      <div class="modal_head flex justify-between items-center">
        <h2 class="text-gray-900 font-bold text-xl"> Update Post </h2>
        <button (click)="closeModal()" class="cursor-pointer">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="modal_body flex flex-col gap-4">
        <div class="flex flex-col gap-4">
          <textarea
            [formControl]="contentControl"
            class="w-full bg-[#f6f6f6] p-2 outline-none rounded-md border border-gray-400 h-24 resize-none"
            [class.border-red-600]="contentControl.errors && contentControl.touched"
            placeholder="Write your thoughts here..."
          ></textarea>
          <label for="upload-img" class="w-full bg-[#f6f6f6] p-2 rounded-md border-2 border-dashed border-gray-400 h-40 flex flex-col justify-center items-center text-center cursor-pointer relative">
            <span class="text-gray-600">click to upload or drag and drop</span>
            <span class="text-gray-500 text-sm">SVG, PNG, JPG or GIF (MAX. 800x400px)</span>
          </label>
          <input
            id="upload-img"
            type="file"
            class="hidden"
            (change)="changeImage($event)"
          />
        </div>
        <div class="modal_footer flex gap-4">
          <button (click)="submitUpdatePost()" class="bg-cyan-600 text-white py-2 px-4 rounded-lg cursor-pointer transition duration-300 hover:bg-cyan-700">Update</button>
          <button (click)="closeModal()" class="text-gray-900 py-2 px-4 border border-gray-400 rounded-lg cursor-pointer transition duration-300 hover:bg-gray-300">Close</button>
        </div>
      </div>
    </div>
  </div>
}
